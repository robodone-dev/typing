<!DOCTYPE html>
<html>
    <head>
        <title>ãƒ­ãƒœå›£ã‚¿ã‚¤ãƒ”ãƒ³ã‚°</title>
        <link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@700&display=swap" rel="stylesheet">
        <meta http-equiv="content-type" charset="utf-8">
        <link rel="stylesheet" href="css/base.css" />
        <script src="//code.createjs.com/1.0.0/createjs.min.js"></script>
        <script src="js/Common.js"></script>
        <script src="js/class/Typing.js"></script>
        <script src="js/class/FlashingText.js"></script>
        <script>
// ---- ---- ---- ---- ---- ---- ---- ---- ---- ---- ---- ---- ---- ---- ---- 
// JavaScript start

// ã‚¿ã‚¤ãƒ”ãƒ³ã‚°ã‚²ãƒ¼ãƒ ã®çŠ¶æ…‹ã‚³ãƒ¼ãƒ‰
const READY = 0;    // æº–å‚™ä¸­
const PLAYING = 1;  // ã‚¿ã‚¤ãƒ”ãƒ³ã‚°ã‚²ãƒ¼ãƒ ä¸­
const END = 2;      // ã‚²ãƒ¼ãƒ çµ‚äº†

var score = 0;      // ã‚¹ã‚³ã‚¢
var timer = 30;     // ã‚¿ã‚¤ãƒãƒ¼ï¼ˆç§’ï¼‰

var countdown = 3;              // æº–å‚™ä¸­ã®ã‚«ã‚¦ãƒ³ãƒˆãƒ€ã‚¦ãƒ³
var wordsFile = "words.txt";    // å•é¡ŒãŒæ ¼ç´ã•ã‚ŒãŸãƒ†ã‚­ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«

var gameState = READY;      // ã‚¿ã‚¤ãƒ”ãƒ³ã‚°ã‚²ãƒ¼ãƒ ã®çŠ¶æ…‹
var typing = new Typing();  // ã‚¿ã‚¤ãƒ”ãƒ³ã‚°ã‚¯ãƒ©ã‚¹

var flashingText = new FlashingText("input", "ã‚¹ãƒšãƒ¼ã‚¹ã‚’æŠ¼ã—ã¦ãã ã•ã„ï¼ï¼", 1000, 500, 0);

var scoreText;
var timerText;

var subject;        // ä¸Šæ®µãƒ†ã‚­ã‚¹ãƒˆè¡¨ç¤ºã‚¹ãƒšãƒ¼ã‚¹ï¼šé¡Œå
var input;          // ä¸‹æ®µãƒ†ã‚­ã‚¹ãƒˆè¡¨ç¤ºã‚¹ãƒšãƒ¼ã‚¹ï¼šå…¥åŠ›è¡¨ç¤ºå†…å®¹

var statementList;  // å•é¡Œãƒªã‚¹ãƒˆ
var statement;      // å•é¡Œæ–‡
var numOfStatement; // å•é¡Œæ–‡ã®ä½•æ–‡å­—ç›®ã‹ã‚’è¡¨ã™ç•ªå·

window.addEventListener("keydown", handleKeydown);
window.addEventListener("keyup", handleKeyup);

// ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã«å®Ÿè¡Œã™ã‚‹å‡¦ç†
window.onload = function(){
    
    statementList = readTextFileToArray(wordsFile);
    typing.insertKeyboard("board");

    // 0:æº–å‚™ä¸­
    if(gameState == READY) {
        
        flashingText.flash();   // é–‹å§‹å‰ã®ãƒ†ã‚­ã‚¹ãƒˆç‚¹æ»…è¡¨ç¤º
    }
}

// ---- ---- ---- ---- ----
// Key å‡¦ç† start

// Keydown å‡¦ç†
function handleKeydown(event) {
    
    // å…¥åŠ›æ–‡å­—ã®å‡¦ç†
    var chara = typing.checkWord(event);
    // alert("æŠ¼ã•ã‚ŒãŸã‚­ãƒ¼ã®ã‚³ãƒ¼ãƒ‰ : " + event.keyCode); 

    // 0:æº–å‚™ä¸­
    if(gameState == READY) {
        if(event.keyCode == 32){    // ã‚¹ãƒšãƒ¼ã‚¹ã‚’æŠ¼ã™ã¨
            startReady();           // å•é¡Œé–‹å§‹å‰ã®æº–å‚™ã¸
        }
    }
    
    // 1:ã‚¿ã‚¤ãƒ”ãƒ³ã‚°ã‚²ãƒ¼ãƒ ä¸­
    if(gameState == PLAYING) {
        judgeTyping(chara);         // æ‰“ã¡è¾¼ã¾ã‚ŒãŸæ–‡å­—ã®æ­£èª¤åˆ¤å®šã¸
    }
}

// Keyup å‡¦ç†
function handleKeyup(event) {

    // CapsLockç¢ºèª
    var capslock;
    
    if(typing.checkCapsLock(event) == 1) {
        capslock = document.getElementById('capslock');
        capslock.innerHTML = "CapsLock ON";
    } else {
        capslock = document.getElementById('capslock');
        capslock.innerHTML = "CapsLock OFF";
    }
}

// Key å‡¦ç† end
// ---- ---- ---- ---- ----

// ã‚²ãƒ¼ãƒ é–‹å§‹å‰ã®æº–å‚™
function startReady() {

    flashingText.setMsg("ã¾ã‚‚ãªãé–‹å§‹ã—ã¾ã™...");
    flashingText.setIsFlashing(0);  // ç‚¹æ»…ã‚’åœæ­¢

    // subject IDã‚¿ã‚°ã«ã‚«ã‚¦ãƒ³ãƒˆãƒ€ã‚¦ãƒ³ã‚’è¡¨ç¤º
    subject = document.getElementById('subject');
    subject.innerHTML = countdown;

    Countdown03_audio();

    // 1ç§’ãŠãã«ã‚«ã‚¦ãƒ³ãƒˆãƒ€ã‚¦ãƒ³
    var id = setInterval(function(){
        countdown--;
        console.log(countdown);
        
        subject.innerHTML = countdown;

        if(countdown <= 0){
            clearInterval(id);
            console.log("Finish!");
            gameState = PLAYING;
            
            startTimer();   // æ®‹ã‚Šæ™‚é–“ã®ã‚«ã‚¦ãƒ³ãƒˆãƒ€ã‚¦ãƒ³ã‚¹ã‚¿ãƒ¼ãƒˆ
            loadSubject();  // å•é¡Œæ–‡ã®èª­ã¿è¾¼ã¿ã¸
        }
    }, 1000);
}


// å•é¡Œæ–‡ã‚’èª­ã¿è¾¼ã¿
function loadSubject() {
    
    // statementList = ["Test", "Apple", "Banana"];
  
    
    // å•é¡Œãƒªã‚¹ãƒˆã‹ã‚‰ãƒ©ãƒ³ãƒ€ãƒ ã«å•é¡Œã‚’å–ã‚Šå‡ºã™
    statement = statementList[Math.floor(Math.random() * statementList.length)];
    
    // å•é¡Œæ–‡ã®è¡¨ç¤º
    subject = document.getElementById('subject');
    subject.innerHTML = statement;

    // å…¥åŠ›å†…å®¹ã®è¡¨ç¤º
    subject = document.getElementById('input');
    subject.innerHTML = "";
    
    numOfStatement = 0;
    
    // alert("ã‚¿ã‚¤ãƒ”ãƒ³ã‚°æ–‡å­—ï¼š" + statement.substr(numOfStatement, 1));
    
    // ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ã®æ­£è§£æ–‡å­—ã‚’è‰²å¤‰ãˆ
    typing.active(statement, numOfStatement);
}

// æ®‹ã‚Šæ™‚é–“ã‚’ã‚«ã‚¦ãƒ³ãƒˆãƒ€ã‚¦ãƒ³
function startTimer() {

    // timer IDã‚¿ã‚°ã«ã‚«ã‚¦ãƒ³ãƒˆãƒ€ã‚¦ãƒ³ã‚’è¡¨ç¤º
    timerText = document.getElementById('timer');
    timerText.innerHTML = "æ®‹ã‚Šæ™‚é–“ï¼š" + timer;
    

    // 1ç§’ãŠãã«ã‚«ã‚¦ãƒ³ãƒˆãƒ€ã‚¦ãƒ³
    var id = setInterval(function(){
        timer--;
        console.log(timer);
        
        timerText.innerHTML = "æ®‹ã‚Šæ™‚é–“ï¼š" + timer;

        if(timer <= 0){
            if(gameState == PLAYING) {

                end_audio();
                // çµ‚äº†å‡¦ç†
                subject = document.getElementById('subject');
                subject.innerHTML = "---- çµ‚äº† ----";
                // alert("çµ‚äº†ï¼ï¼");
                gameState = END;
                clearInterval(id);
            }
        }
    }, 1000);
}

// æ‰“ã¡è¾¼ã¾ã‚ŒãŸæ–‡å­—ã®æ­£èª¤åˆ¤å®š
function judgeTyping(chara) {
    var seikai = statement.substr(numOfStatement, 1);
    
    if(chara == seikai) {
        // æ­£è§£ã®å ´åˆ
        score = score + 10;
        push_audio();

        // æ­£è§£æ–‡å­—ã‚’è¿½åŠ ï¼ˆinput IDã‚¿ã‚°ã«è¿½è¨˜ï¼‰
        var input = document.getElementById('input');
        input.innerHTML = input.innerHTML + chara;
        
        // æ¬¡ã®æ–‡å­—ã¸
        numOfStatement = numOfStatement + 1;
        
        if(statement.length != numOfStatement) {
            // å•é¡Œæ–‡ã®æ–‡å­—ãŒç¶šãå ´åˆ
            typing.active(statement, numOfStatement);
            
        } else {
            score = score + 50;
            next_audio();
            // æ¬¡ã®å•é¡Œã¸
            loadSubject();
        }
        
    } else {
        // é–“é•ã„ã®å ´åˆ
        // ä½•ã‚‚ã—ãªã„
        wrong_audio();
    }
    
    // ã‚¹ã‚³ã‚¢ã‚’æ›´æ–°
    scoreText = document.getElementById('score');
    scoreText.innerHTML = "ã‚¹ã‚³ã‚¢ï¼š" + score;
}

function bgm1_audio() {
    var obj = document.getElementById('bgm1');
    obj.volume = 0.2;
    document.getElementById('bgm1').play(); //ã‚¯ãƒªãƒƒã‚¯ã—ãŸã‚‰éŸ³ã‚’å†ç”Ÿ
}
function push_audio() {
    document.getElementById('btn_push').currentTime = 0; //é€£ç¶šã‚¯ãƒªãƒƒã‚¯ã«å¯¾å¿œ
    document.getElementById('btn_push').play(); //ã‚¯ãƒªãƒƒã‚¯ã—ãŸã‚‰éŸ³ã‚’å†ç”Ÿ
}           
function wrong_audio() {
    document.getElementById('btn_wrong').currentTime = 0; //é€£ç¶šã‚¯ãƒªãƒƒã‚¯ã«å¯¾å¿œ
    document.getElementById('btn_wrong').play(); //ã‚¯ãƒªãƒƒã‚¯ã—ãŸã‚‰éŸ³ã‚’å†ç”Ÿ
}
function next_audio() {
    document.getElementById('next_word').currentTime = 0; //é€£ç¶šã‚¯ãƒªãƒƒã‚¯ã«å¯¾å¿œ
    document.getElementById('next_word').play(); //ã‚¯ãƒªãƒƒã‚¯ã—ãŸã‚‰éŸ³ã‚’å†ç”Ÿ
}
function Countdown03_audio() {
    document.getElementById('countdown03').currentTime = 0; //é€£ç¶šã‚¯ãƒªãƒƒã‚¯ã«å¯¾å¿œ
    document.getElementById('countdown03').play(); //ã‚¯ãƒªãƒƒã‚¯ã—ãŸã‚‰éŸ³ã‚’å†ç”Ÿ
}
function end_audio() {
    document.getElementById('end').play(); //ã‚¯ãƒªãƒƒã‚¯ã—ãŸã‚‰éŸ³ã‚’å†ç”Ÿ
}

// JavaScript end
// ---- ---- ---- ---- ---- ---- ---- ---- ---- ---- ---- ---- ---- ---- ---- 
        </script>
    </head>
    <body>
      <div id="video-area">
        <video id="video" poster="" webkit-playsinline playsinline muted autoplay loop>
        <source src="https://robodone-dev.github.io/typing/js_typing_game-master/video/Blue_9809.mp4" type="video/mp4">
      </div>



        <!-- ãƒ¢ãƒ¼ãƒ€ãƒ«è¡¨ç¤º -->
        <div id="easyModal" class="modal">
        <div class="modal-content">
          <div class="modal-header">
            <h1>Good job ğŸ‰</h1>
            <span class="modalClose"></span>
          </div>
          <div class="modal-body">
            <p id="score-1"></p>
            <p id="score-2"></p>
            <button id="modalOpen" class="button">ãƒªãƒˆãƒ©ã‚¤</button>
          </div>
        </div>
      </div>

        <!-- ãƒ‘ãƒãƒ«è¡¨ç¤º -->
        <div id="panel">
            <div id="score">ã‚¹ã‚³ã‚¢ï¼š0</div>
            <div id="timer">æ®‹ã‚Šæ™‚é–“ï¼š--</div>
            <div id="capslock">CapsLock --</div>
            <div id="subject">ãƒ­ãƒœå›£ ã‚¿ã‚¤ãƒ”ãƒ³ã‚°ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°</div>
            <div id="input">input</div>
        </div>
        <!-- ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰è¡¨ç¤º -->
        <div id="board">
        </div>
        
        <audio id="bgm1">
            <source src="./audio/bgm1.mp3" type="audio/mp3">
        </audio>
        <audio id="btn_wrong">
            <source src="./audio/Quiz-Wrong_Buzzer02-1.mp3" type="audio/mp3">
        </audio>
        <audio id="btn_push">
            <source src="./audio/btn_push.mp3" type="audio/mp3">
        </audio>
        <audio id="next_word">
            <source src="./audio/clear.mp3" type="audio/mp3">
        </audio>
       <audio id="countdown03">
            <source src="./audio/Countdown06-2.mp3" type="audio/mp3">
        </audio>
       <audio id="end">
            <source src="./audio/end.wav" type="audio/wav">
        </audio>

    </body>
    <foot>
        
    </foot>
</html>
